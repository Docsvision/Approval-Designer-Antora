= Изменение элемента "HTMLинформация"

В разметках карточек Задание КС для отображения информации о задании используется элемент "HTMLинформация" -- HTML браузер, данные для которого формируются XSLT-преобразованием.

Настройки элемента "HTMLинформация" можно изменять со следующим ограничением: в параметре "XSL преобразование" можно использовать только XSLT-пути, которые уже используются в данном параметре. Если в "XSL преобразовании" нужно обращаться к другим данным (например, полям связанных карточек), необходимо в скрипт карточки задания добавить следующий код:

[source,csharp]
----
using System.Xml;
using System.IO;
....
public virtual void CardActivated({dv}.Platform.WinForms.CardActivatedEventArgs e)
{
   SetInformationControlXMLGenerator(); // Данный метод будет загружать нестандартные данные
   this.ApprovalTaskScript.CardActivated(e);            
}        

// Данный метод добавляет в переменную this.ApprovalTaskScript.InformationControlXMLGenerator узлы, 
//  к которым требуется доступ
// В качестве примера добавляется доступ к полю MainInfo.Name согласуемого документа
private void SetInformationControlXMLGenerator()
{
  var generator = this.ApprovalTaskScript.InformationControlXMLGenerator;
  this.ApprovalTaskScript.InformationControlXMLGenerator = (CardData taskCardData)=>
   {
      string xmlString = generator(taskCardData);
      var doc = new XmlDocument();
      doc.LoadXml(xmlString);
      
      var items = doc.GetElementsByTagName("CardDocument");
      foreach (XmlNode item in items)
      {
        XmlElement documentElement = (XmlElement)item;
        Guid cardId = Guid.Parse(documentElement.GetAttribute("CardID"));
        var documentCardData = taskCardData.Session.CardManager.GetCardData(cardId, false);
                    
        XmlElement mainInfoElement = (XmlElement)documentElement.SelectSingleNode("MainInfo");
        Guid mainInfoSectionId = new Guid("30eb9b87-822b-4753-9a50-a1825dca1b74");
        string documentName = (string)documentCardData.Sections[mainInfoSectionId].FirstRow.GetString("Name");
        mainInfoElement.SetAttribute("Name", documentName);
      }
                
      using (var stringWriter = new StringWriter())
      using (var xmlTextWriter = XmlWriter.Create(stringWriter))
      {
          doc.WriteTo(xmlTextWriter);
          xmlTextWriter.Flush();
          
          return stringWriter.GetStringBuilder().ToString();
      }
  };
}
----
