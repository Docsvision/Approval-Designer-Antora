= Сформировать карту этапов

_Карта этапов_ определяет этапы, входящие в состав маршрута, а также условия перехода между ними (в зависимости от результатов завершения предыдущих этапов).

При настройке маршрута согласования нужно учитывать принцип, по которому выбираются этапы согласования:

При завершении каждого этапа согласования начинается поиск следующего не запускавшегося в данном цикле этапа, соответствующего условиям запуска.

.Если подходящий этап не найден:
* Если все этапы данного цикла завершены положительно, согласование завершается.
* Если есть не положительно завершённые этапы, запускается новый цикл согласования.
+
Автоматический переход на новый цикл согласования можно исключить, добавив этап консолидации (можно без участников) после этапов, которые могут завершиться условно-положительно.

.Чтобы настроить карту этапов:
. Создайте или откройте ранее созданную карточку _Маршрут согласования_.
. В области _Общие_ укажите _Название_ маршрута.
. В поле _Автора_ укажите поле-источник, из которого будет выбираться автор для задания маршрута.
. Подобным образом выберите поле-источник для _Регистратора_.
. Установите флаг `*{um}*`, чтобы использовать xref:route-advanced.adoc[новую логику] согласования.
. {um} позволяет xref:route-advanced.adoc#completion[задать] условия _Успешного завершения_ и _Отрицательного завершения_ в соответствующих полях.
. В области _Карта этапов_ нажмите на кнопку image:buttons/plus-green.png[Плюс] *Добавить*, чтобы отобразить строку для настройки этапа.
+
.Поля для настройки этапа в "Карте этапов"
image::add-stage.png[Поля для настройки этапа в "Карте этапов"]
+
. Нажмите image:buttons/three-dots.png[Три точки] и выберите карточку этапа из созданных ранее.
+
Одна и та же карточка _Этап согласования_ может быть использована в разных маршрутах.
+
Один этап можно добавить в один маршрут только один раз. Повторно добавлять тот же этап в маршрут запрещено.
+
include::partial$excerpts.adoc[tags=stage]
+
Допускается добавлять новые этапы даже в те маршруты, по которым на момент добавления выполняется активное согласование документов. При удовлетворении условий запуска, новый этап может быть пройден уже в текущем цикле согласования. Аналогично, при удалении этапа из активного маршрута, изменения будут применены в текущем цикле согласования.
+
. xref:route-advanced.adoc#first[Обозначьте] один или несколько этапов как `*Первый*`. По умолчанию флагом `*Первый*` обозначается верхний в списке этап.
. Добавьте необходимое количество этапов.
. xref:route-stage-conditions.adoc[Задайте] условия старта для этапов.
+
В _Карте этапов_ столбцы _Тип согласования_, _Согласующие_ и _Длительность_ будут автоматически заполнены исходя из данных карточки _Этап согласования_.
+
. При необходимости {um} позволяет повторять этапы внутри цикла. Для каждого этапа укажите, когда он должен повторяться:
+
include::partial$excerpts.adoc[tags=repeat]
+
. Чтобы этапы отображались в карте в соответствии с заданными условиями старта, воспользуйтесь кнопками image:buttons/arrow-up-green.png[Стрелка вверх] и image:buttons/arrow-down-green.png[Стрелка вниз] для перемещения записей этапов вверх или вниз по списку.
+
Отображение этапов в таблице никак не влияет на фактический порядок старта этапов, который определяется заданными для этапа условиями.
