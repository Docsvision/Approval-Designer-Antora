= Матрица состояний документа

Для каждого этапа согласования необходимо определить состояния, в которых будет находиться карточка вида _Документ УД_ во время прохождения данного этапа, а также – при отрицательном результате завершения этапа. В матрице предусмотрена возможность добавления, удаления и редактирования записей.

+++Если оставить матрицу состояний пустой, смены состояний документа на данном этапе происходить не будет.+++

В _Конструкторе состояний_ *должны быть настроены переходы между используемыми в матрице состояниями карточки документа*:

* для первого этапа должен быть настроен переход из состояния `На согласовании` в выбранное состояние этапа;
+
Обратите внимание: стартовое состояние согласования (`На согласовании`), в которое переходит документ при отправке на согласование, должно:
+
. Быть зарегистрировано в Конструкторе состояний для вида ДокументУД.
. Иметь `BuildInState` равный "209CDCE5-83B8-4FAC-B9E5-851E6ED3A3E2" или `DefaultName` равный "Is approving" (или "OnApproving").
* для последующих этапов должен быть настроен переход из состояния предыдущего этапа в выбранное состояние этапа;
* должен быть настроен переход в то состояние, которое xref:Path_DocFinalState.adoc[выбрано в качестве итогового] в карточке _Маршрут согласования_.
+
В _Конструкторе ролей_ *операция перехода должна быть разрешена для роли "Системная для WF"*.

.Чтобы настроить матрицу состояний, выполните следующие действия:
. Создайте новую или откройте существующую карточку этапа.
. Перейдите на вкладку xref:StageParams_extra.adoc[Дополнительные настройки].
. В области *Матрица состояний документа* нажмите на кнопку image:buttons/add_little_plus.png[image] *Добавить*.
+
Будет открыто окно *Состояния документа*.
+
.Добавление состояния в "Матрицу состояний"
image::Stage_StateMatrix_add.png[Добавление состояния в "Матрицу состояний"]
+
. Заполните поля окна *Состояния документа*:
* В поле *Вид документа* выберите требуемый вид:
** если выбран пользовательский вид карточки, в матрице будут доступны все состояния, существующие для этого вида;
** если выбран вид _Документ УД_, в процессе работы будут учитываться состояния для дочерних видов (например, _Документ УД - Исходящий_ и др.). Например, если в матрице отсутствуют настройки для дочернего вида, будут использоваться настройки состояний для родительского вида _Документ УД_.
* В поле *Состояние этапа* укажите название состояния. Выбор значения производится из _Конструктора состояний_, где должна быть обязательно настроена операция перехода в выбранное состояние из того состояния, в котором находится документ перед стартом этапа.
* В поле *Состояние при положительном результате* укажите название состояния при положительном решении по согласованию. Выбор значения производится из _Конструктора состояний_.
* В поле *Состояние при отрицательном результате* укажите название состояния при отрицательном решении по согласованию. Выбор значения производится из _Конструктора состояний_;
+
Поле *Вид документа* является обязательным для заполнения. Также обязательно должно быть заполнено хотя бы одно из полей для настройки состояний.
. Нажмите на кнопку *ОК*.
+
В таблице области *Матрица состояний* появится новая запись о состоянии карточки.
+
.Отображение записи о состоянии документа в "Матрице состояний"
image::Stage_StateMatrix.png[Отображение записи о состоянии документа в "Матрице состояний"]
+
Для настройки возможности переноса в карточку _Документ_ итоговых файлов, полученных по результатам согласования, в _Конструкторе состояний_ для выбранного состояния должна быть разрешена операция _Редактирование основного файла_.
