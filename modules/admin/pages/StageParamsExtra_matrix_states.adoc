[[ariaid-title1]]
== Матрица состояний документа

Для каждого этапа согласования необходимо определить состояния, в которых будет находиться карточка вида [.keyword .parmname]_Документ УД_ во время прохождения данного этапа, а также – при отрицательном результате завершения этапа. В матрице предусмотрена возможность добавления, удаления и редактирования записей.

+++Если оставить матрицу состояний пустой, смены состояний документа на данном этапе происходить не будет.+++

В [.dfn .term]_Конструкторе состояний_ *должны быть настроены переходы между используемыми в матрице состояниями карточки документа*:

* для первого этапа должен быть настроен переход из состояния `На                             согласовании` в выбранное состояние этапа;
+
Обратите внимание: стартовое состояние согласования (`На                                 согласовании`), в которое переходит документ при отправке на согласование, должно:
. Быть зарегистрировано в Конструкторе состояний для вида ДокументУД.
. Иметь `BuildInState` равный «209CDCE5-83B8-4FAC-B9E5-851E6ED3A3E2» или `DefaultName` равный «Is approving» (или «OnApproving»).
* для последующих этапов должен быть настроен переход из состояния предыдущего этапа в выбранное состояние этапа;
* должен быть настроен переход в то состояние, которое xref:Path_DocFinalState.adoc[выбрано в качестве итогового] в карточке [.keyword .parmname]_Маршрут согласования_.

В [.dfn .term]_Конструкторе ролей_ *операция перехода должна быть разрешена для роли «Системная для WF»*.

Чтобы настроить матрицу состояний, выполните следующие действия:

[[task_q1q_jbs_mm__steps_vsf_jxr_mm]]
. [.ph .cmd]#Создайте новую или откройте существующую карточку этапа.#
. [.ph .cmd]#Перейдите на вкладку xref:StageParams_extra.adoc[Дополнительные настройки].#
. [.ph .cmd]#В области [.keyword]*Матрица состояний документа* нажмите на кнопку image:img/Buttons/add_little_plus.png[image] [.keyword]*Добавить*.#
+
Будет открыто окно [.keyword .wintitle]*Состояния документа*.

image::img/Stage_StateMatrix_add.png[[.fig--title-label]##Рис. 1. ##Добавление состояния в 'Матрицу состояний']
. [.ph .cmd]#Заполните поля окна [.keyword .wintitle]*Состояния документа*:#
* В поле [.keyword]*Вид документа* выберите требуемый вид:
** если выбран пользовательский вид карточки, в матрице будут доступны все состояния, существующие для этого вида;
** если выбран вид [.keyword .parmname]_Документ УД_, в процессе работы будут учитываться состояния для дочерних видов (например, [.keyword .parmname]_Документ УД - Исходящий_ и др.). Например, если в матрице отсутствуют настройки для дочернего вида, будут использоваться настройки состояний для родительского вида [.keyword .parmname]_Документ УД_.
* В поле [.keyword]*Состояние этапа* укажите название состояния. Выбор значения производится из [.dfn .term]_Конструктора состояний_, где должна быть обязательно настроена операция перехода в выбранное состояние из того состояния, в котором находится документ перед стартом этапа.
* В поле [.keyword]*Состояние при положительном результате* укажите название состояния при положительном решении по согласованию. Выбор значения производится из [.dfn .term]_Конструктора состояний_.
* В поле [.keyword]*Состояние при отрицательном результате* укажите название состояния при отрицательном решении по согласованию. Выбор значения производится из [.dfn .term]_Конструктора состояний_;
+
Поле [.keyword]*Вид документа* является обязательным для заполнения. Также обязательно должно быть заполнено хотя бы одно из полей для настройки состояний.
. [.ph .cmd]#Нажмите на кнопку [.ph .uicontrol]*ОК*.#
+
В таблице области [.keyword]*Матрица состояний* появится новая запись о состоянии карточки.

image::img/Stage_StateMatrix.png[[.fig--title-label]##Рис. 2. ##Отображение записи о состоянии документа в 'Матрице состояний']

Для настройки возможности переноса в карточку [.dfn .term]_Документ_ итоговых файлов, полученных по результатам согласования, в [.dfn .term]_Конструкторе состояний_ для выбранного состояния должна быть разрешена операция [.keyword .parmname]_Редактирование основного файла_.

*На уровень выше:* xref:../pages/StageParams_extra.adoc[Дополнительные настройки]
