= Выбор согласующих

Состав согласующих может определяться различными способами: либо явно задаваться из _Справочника сотрудников_, либо считываться из определенного поля карточки _Документ_, либо вычисляться сторонним бизнес-процессом. В один момент времени может использоваться только один вариант выбора согласующих.

.Чтобы определить список согласующих, выполните следующие действия:
. Создайте новую или откройте существующую карточку этапа.
. Перейдите на вкладку *Параметры этапа*.
. Определите способ выбора согласующих:
* _Задать согласующих_ - выбор будет выполняться из _Справочника сотрудников_, открытого на выбор;
* _Использовать значение из поля карточки документа_ - выбор будет выполняться из заданного поля карточки документа;
* _Использовать бизнес-процесс для вычисления согласующих_ - выбор сотрудников будет выполняться с использованием стороннего бизнес-процесса, возвращающего коллекцию сотрудников – участников согласования.
. Если предполагается явно выбирать сотрудников из _Справочника сотрудников_:
[loweralpha]
.. Выберите опцию _Задать согласующих_.
+
Станет активным поле выбора согласующих.

image::Stage_reconcilers_directory.png[Выбор согласующих из "Справочника сотрудников"]
.. Выберите согласующих в данном поле. В качестве согласующих могут быть выбраны:
* сотрудник (значение из _Справочника сотрудников_);
* организация/подразделение (значение из _Справочника сотрудников_);
* группа (значение из _Справочника сотрудников_);
* роль (значение из _Справочника сотрудников_);
* последние использованные значения (из введенных ранее);
* xref:Search_words_reconciles.adoc[поисковые слова].
.. [#task_lry_2jq_mm__hierarchy_level]#Если для выбора согласующих используется поисковое слово _Все руководители инициатора_, дополнительно можно задать уровень положения руководителя в дереве руководства организации. Для этого следует в параметре *Уровень иерархии* указать целое числовое значение, обозначающее уровень в иерархии.#
+
Порядок определяется снизу вверх. Например, уровень непосредственного руководителя 1, уровень руководителя этого руководителя 2, и так далее вверх по дереву.
. [#task_lry_2jq_mm__doccard_field]#Если предполагается указывать сотрудников из определенного поля в структуре карточки _Документ_, где хранятся значения сотрудников-согласующих:
[loweralpha]
.. Выберите вариант _Использовать значение из поля карточки документа_.
.. В поле *Поле документа* выберите поле или секцию карточки _Документ_, откуда следует загружать данные о сотрудниках.
+
[IMPORTANT]
====
Допускается также выбор динамических полей и секций. После создания данных полей в _Конструкторе разметок_, перезапустите сервис _Workflow_ для корректной работы бизнес-процессов.
====
. [#task_lry_2jq_mm__search_business_process]#Если предполагается использовать бизнес-процесс для поиска сотрудников:
[loweralpha]
.. Выберите вариант _ Использовать бизнес-процесс для вычисления согласующих_;
.. В поле *Бизнес-процесс* выберите шаблон бизнес-процесса, который должен быть запущен в момент старта этапа.
+
Процесс должен возвращать коллекцию сотрудников. При старте согласования, поле *Состав маршрута* для этапа с данным типом вычисления согласующих будет всегда пустым. Состав согласующих будет определяется по ходу прохождения согласования.

Для передачи переменных в процесс, который определен как источник согласующих, а также получения переменных из него, необходимо в этом процессе создать набор переменных, совпадающих по имени и типу с таковыми в родительском процессе (это будет или _КС Подпроцесс параллельное согласование_ или _КС Подпроцесс последовательное согласование_, в зависимости от типа маршрутизации этапа).

В подключаемом бизнес-процессе должна быть настроена переменная-коллекция типа _Сотрудник DV_ с названием _Согласующие_. Именно в неё будут записаны вычисленные процессом сотрудники. Чтобы передача значений переменных из родительских процессов стала возможной, в настройках переменной необходимо нажать кнопку *Дополнительно* и в открывшемся окне снять флаг *Скрыта от родительского процесса*.

_КС Подпроцесс параллельное согласование_ или _КС Подпроцесс последовательное согласование_ передают в подпроцесс определения согласующих значения, определенные в настройках переменных в момент создания экземпляра этого подпроцесса. По окончании работы подпроцесса значения всех его переменных, соответствующие переменным родительского процесса, будут возвращены в переменные процессов _КС Подпроцесс параллельное согласование_ или _КС Подпроцесс последовательное согласование_.
