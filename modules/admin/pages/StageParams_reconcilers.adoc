[[ariaid-title1]]
== Выбор согласующих

Состав согласующих может определяться различными способами: либо явно задаваться из [.dfn .term]_Справочника сотрудников_, либо считываться из определенного поля карточки [.dfn .term]_Документ_, либо вычисляться сторонним бизнес-процессом. В один момент времени может использоваться только один вариант выбора согласующих.

Чтобы определить список согласующих, выполните следующие действия:

[[task_lry_2jq_mm__steps_pgl_jjq_mm]]
. [.ph .cmd]#Создайте новую или откройте существующую карточку этапа.#
. [.ph .cmd]#Перейдите на вкладку [.keyword]*Параметры этапа*.#
. [.ph .cmd]#Определите способ выбора согласующих:#
* [.keyword .parmname]_Задать согласующих_ - выбор будет выполняться из [.dfn .term]_Справочника сотрудников_, открытого на выбор;
* [.keyword .parmname]_Использовать значение из поля карточки документа_ - выбор будет выполняться из заданного поля карточки документа;
* [.keyword .parmname]_Использовать бизнес-процесс для вычисления согласующих_ - выбор сотрудников будет выполняться с использованием стороннего бизнес-процесса, возвращающего коллекцию сотрудников – участников согласования.
. [.ph .cmd]#Если предполагается явно выбирать сотрудников из [.dfn .term]_Справочника сотрудников_:#
[loweralpha]
.. [.ph .cmd]#Выберите опцию [.keyword .parmname]_Задать согласующих_.#
+
Станет активным поле выбора согласующих.

image::img/Stage_reconcilers_directory.png[[.fig--title-label]##Рис. 1. ##Выбор согласующих из 'Справочника сотрудников']
.. [.ph .cmd]#Выберите согласующих в данном поле. В качестве согласующих могут быть выбраны: #
* сотрудник (значение из [.dfn .term]_Справочника сотрудников_);
* организация/подразделение (значение из [.dfn .term]_Справочника сотрудников_);
* группа (значение из [.dfn .term]_Справочника сотрудников_);
* роль (значение из [.dfn .term]_Справочника сотрудников_);
* последние использованные значения (из введенных ранее);
* xref:Search_words_reconciles.adoc[поисковые слова].
.. [#task_lry_2jq_mm__hierarchy_level]#[.ph .cmd]#Если для выбора согласующих используется поисковое слово [.keyword .parmname]_Все руководители инициатора_, дополнительно можно задать уровень положения руководителя в дереве руководства организации. Для этого следует в параметре [.keyword]*Уровень иерархии* указать целое числовое значение, обозначающее уровень в иерархии. ##
+
Порядок определяется снизу вверх. Например, уровень непосредственного руководителя 1, уровень руководителя этого руководителя 2, и так далее вверх по дереву.
. [#task_lry_2jq_mm__doccard_field]#[.ph .cmd]#Если предполагается указывать сотрудников из определенного поля в структуре карточки [.dfn .term]_Документ_, где хранятся значения сотрудников-согласующих: ##
[loweralpha]
.. [.ph .cmd]#Выберите вариант [.keyword .parmname]_Использовать значение из поля карточки документа_.#
.. [.ph .cmd]#В поле [.keyword]*Поле документа* выберите поле или секцию карточки [.dfn .term]_Документ_, откуда следует загружать данные о сотрудниках.#
+
[NOTE]
====
[.note__title]#Важное замечание:# Допускается также выбор динамических полей и секций. После создания данных полей в [.dfn .term]_Конструкторе разметок_, перезапустите сервис [.dfn .term]_Workflow_ для корректной работы бизнес-процессов.
====
. [#task_lry_2jq_mm__search_business_process]#[.ph .cmd]#Если предполагается использовать бизнес-процесс для поиска сотрудников: ##
[loweralpha]
.. [.ph .cmd]#Выберите вариант [.keyword .parmname]_ Использовать бизнес-процесс для вычисления согласующих_;#
.. [.ph .cmd]#В поле [.keyword]*Бизнес-процесс* выберите шаблон бизнес-процесса, который должен быть запущен в момент старта этапа.#
+
Процесс должен возвращать коллекцию сотрудников. При старте согласования, поле [.keyword]*Состав маршрута* для этапа с данным типом вычисления согласующих будет всегда пустым. Состав согласующих будет определяется по ходу прохождения согласования.

Для передачи переменных в процесс, который определен как источник согласующих, а также получения переменных из него, необходимо в этом процессе создать набор переменных, совпадающих по имени и типу с таковыми в родительском процессе (это будет или [.keyword .parmname]_КС Подпроцесс параллельное согласование_ или [.keyword .parmname]_КС Подпроцесс последовательное согласование_, в зависимости от типа маршрутизации этапа).

В подключаемом бизнес-процессе должна быть настроена переменная-коллекция типа [.keyword .parmname]_Сотрудник DV_ с названием [.keyword .parmname]_Согласующие_. Именно в неё будут записаны вычисленные процессом сотрудники. Чтобы передача значений переменных из родительских процессов стала возможной, в настройках переменной необходимо нажать кнопку [.ph .uicontrol]*Дополнительно* и в открывшемся окне снять флаг [.keyword]*Скрыта от родительского процесса*.

[.keyword .parmname]_КС Подпроцесс параллельное согласование_ или [.keyword .parmname]_КС Подпроцесс последовательное согласование_ передают в подпроцесс определения согласующих значения, определенные в настройках переменных в момент создания экземпляра этого подпроцесса. По окончании работы подпроцесса значения всех его переменных, соответствующие переменным родительского процесса, будут возвращены в переменные процессов [.keyword .parmname]_КС Подпроцесс параллельное согласование_ или [.keyword .parmname]_КС Подпроцесс последовательное согласование_.

* *xref:../pages/Search_words_reconciles.adoc[Поисковые слова]* +

*На уровень выше:* xref:../pages/StageParams.adoc[Параметры этапа]
