= Выбор согласующих

Состав согласующих может определяться различными способами: явно задаваться из _Справочника сотрудников_, считываться из определенного поля карточки _Документ_ или вычисляться сторонним бизнес-процессом. В один момент времени может использоваться только один вариант выбора согласующих.

.Чтобы определить список согласующих:
. Создайте новую или откройте существующую карточку этапа.
. Перейдите на вкладку _Параметры этапа_.
. Определите способ выбора согласующих:
+
* *Задать согласующих* -- согласующих можно будет выбрать из _Справочника сотрудников_, открытого на выбор.
* *Использовать значение из поля карточки документа* -- согласующих можно будет выбрать из заданного поля карточки документа.
* *Использовать бизнес-процесс для вычисления согласующих* -- согласующих будет выбирать сторонний бизнес-процесс, возвращающий коллекцию сотрудников -- участников согласования.

== Выбор сотрудников вручную

.Если предполагается явно выбирать сотрудников из Справочника сотрудников:
. Выберите опцию *Задать согласующих*, чтобы активировать поле выбора согласующих.
+
.Выбор согласующих из "Справочника сотрудников"
image::Stage_reconcilers_directory.png[Выбор согласующих из "Справочника сотрудников"]
+
. Выберите согласующих в поле.
+
.В качестве согласующих могут быть выбраны следующие значения из "Справочника сотрудников":
* Сотрудник.
* Организация или подразделение.
* Группа.
* Роль.
* Последние использованные значения -- одно из введённых ранее значений.
* <<search-words,Поисковые слова>>.
+
[#hierarchy]
[NOTE]
====
Если для выбора согласующих используется поисковое слово _Все руководители инициатора_, дополнительно можно задать положение руководителя в дереве руководства организации. Для этого следует в поле _Уровень иерархии_ указать целое числовое значение, обозначающее уровень в иерархии.

Порядок определяется снизу вверх. Например, уровень непосредственного руководителя -- `1`, уровень руководителя этого руководителя -- `2`, и так далее вверх по дереву.
====

[#card-field]
== Выбор сотрудников из поля карточки документа

.Если предполагается указывать сотрудников из определенного поля в структуре карточки:
. Выберите вариант *Использовать значение из поля карточки документа*.
. Выберите _Документ_, поле или секцию карточки, из которого следует загружать данные о сотрудниках, в _Поле документа_.
+
[IMPORTANT]
====
Выбирать можно также динамические поля и секции. После создания данных полей в _Конструкторе разметок_, перезапустите сервис _Workflow_, чтобы бизнес-процессы работали корректно.
====

[#business-proces]
== Выбор сотрудников бизнес-процессом

.Если предполагается использовать бизнес-процесс для поиска сотрудников:
. Выберите вариант *Использовать бизнес-процесс для вычисления согласующих*;
. В поле _Бизнес-процесс_ выберите шаблон бизнес-процесса, который должен быть запущен при старте этапа.
+
****
Процесс должен возвращать коллекцию сотрудников. Для этапа с данным типом вычисления согласующих, поле _Состав маршрута_ будет всегда пустым. Состав согласующих будет определён в ходе согласования.

Чтобы передавать и получать переменные из процесса, который определен как источник согласующих, в этом процессе необходимо создать набор переменных. Данные переменные должны совпадать по имени и типу с переменными в родительском процессе. В зависимости от типа маршрутизации этапа это будет или _КС Подпроцесс параллельное согласование_ или _КС Подпроцесс последовательное согласование_.

В подключаемом бизнес-процессе должна быть настроена переменная-коллекция типа _Сотрудник DV_ с названием _Согласующие_. Именно в неё будут записаны вычисленные процессом сотрудники. Чтобы стало возможным передавать значения переменных из родительских процессов, в настройках переменной необходимо нажать кнопку *Дополнительно* и в открывшемся окне снять флаг `*Скрыта от родительского процесса*`.

_КС Подпроцесс параллельное согласование_ или _КС Подпроцесс последовательное согласование_ передают значения, определенные в настройках переменных в подпроцесс определения согласующих. Значения переменных передаются в момент создания экземпляра подпроцесса.

По окончании работы подпроцесса значения всех его переменных, соответствующие переменным родительского процесса, будут возвращены в переменные процессов _КС Подпроцесс параллельное согласование_ или _КС Подпроцесс последовательное согласование_.
****

[#search-words]
== Поисковые слова

Руководитель инициатора::
Будут найдены сотрудники, указанные в _Справочнике сотрудников_ как непосредственные руководители сотрудника-инициатора согласования. Дополнительно можно настроить <<hierarchy,уровень иерархии>> руководителя, в соответствии с которым будет осуществляться поиск.

Все руководители инициатора::
Будут найдены сотрудники, которые указаны в _Справочнике сотрудников_ как непосредственные и вышестоящие руководители сотрудника-инициатора согласования.

Инициатор::
Будет указан сотрудник, который создал согласование из карточки _Документ_.

Регистратор::
Будет указан сотрудник, который создал карточку вида _Документ УД_, и зарегистрировал документ в системе _{dv}_.
