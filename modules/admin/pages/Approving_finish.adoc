= Правила завершения согласований

В рамках каждого этапа процесса согласования формируется некоторое количество заданий, каждое из которых может быть завершено одним из возможных способов, определенных семантикой решения. Результат завершения этапа будет вычисляться исходя из решений, вынесенных согласующими в заданиях на согласование.

.Пример процесса согласования
image::Path_finish_success.png[Пример процесса согласования]

В данной версии модуля _Конструктора согласований_ предусмотрены следующие xref:task-decisions.adoc[варианты решений], которые могут быть приняты согласующими:

* _Положительное_ (например, "Согласовать", "Подписать");
* _Условно-положительное_ (например, "Согласовать с замечаниями");
* _Отрицательное_ (например, "Не утвердить", "Отказать");
* _Новый цикл_ -- запуск нового цикла согласования (повторный старт маршрута);
* _Отмена_ -- отмена текущего согласования с отзывом всех заданий (например, "Вернуть на подготовку");
* _Завершение_ -- окончание процесса согласования, документ прошел все этапы процесса -- согласован, подписан, зарегистрирован и т.д. (Например, "Зарегистрировать").

.Правила завершения этапов:
* Этап завершается ПОЛОЖИТЕЛЬНО, если все входящие в него задания завершились с семантикой _Положительное_;
* Этап завершается УСЛОВНО-ПОЛОЖИТЕЛЬНО, если задания завершились с семантикой _Положительное_ и _Условно-положительное_;
* Этап завершается ОТРИЦАТЕЛЬНО, если хотя бы одно задание завершено с семантикой _Отрицательное_;
* Как только задание на этапе завершается с результатом _Новый цикл_, все задания, не завершенные на этом этапе (если такие ещё есть) отзываются, стартует НОВЫЙ ЦИКЛ согласования;
* Если задание на каком-либо этапе завершается с семантикой _Отмена_, задания КС отзываются, согласование аннулируется, а согласуемый документ возвращается в состояние `Подготовка`;
* Если задание завершается с семантикой *Завершение*, это означает, что завершается целиком весь процесс согласования, документ переводится с финальное состояние (определенное в настройках карточки *Маршрут согласования*).

.Этап может быть завершен ПРИНУДИТЕЛЬНО:
* инициатором из карточки открытого согласования, командой *Прекратить текущий этап* (см. _Модуль "{dv} 5. {ad}". Руководство пользователя_);
* при первом отказе одним из согласующих, при значении настройки xref:StageParamsExtra_stage_finish.adoc[*При первом отказе*] равном _Завершить этап_.
+
[NOTE]
====
В некоторых случаях, для завершения этапа может использоваться семантика, xref:StageParamsExtra_stage_finish.adoc[заданная по умолчанию] и другие настройки. Например, семантика будет применена, если в настройках этапа не были заданы согласующие.
====

.Правила завершения маршрута согласования:
* Маршрут завершается АВТОМАТИЧЕСКИ, если положительно завершились все его этапы;
* При завершении маршрута согласование перейдёт на новый цикл, если один из этапов завершился условно-положительно и после данного этапа не было консолидации.
* Маршрут может быть завершен ПРИНУДИТЕЛЬНО:
** *Инициатором* из карточки Согласования;
** пользователем из карточки задания на согласование при выборе варианта решения с xref:task-decisions.adoc[семантикой] *Завершение*;
** при первом отказе одним из согласующих, при значении настройки xref:StageParamsExtra_stage_finish.adoc[*При первом отказе*] равном _Завершить согласование_.
