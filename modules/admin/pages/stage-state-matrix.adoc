= Матрица состояний документа

Для каждого этапа согласования необходимо определить состояния, в которых будет находиться карточка вида _Документ УД_ во время прохождения данного этапа, а также -- при отрицательном результате завершения этапа. В матрице предусмотрена возможность добавления, удаления и редактирования записей.

[IMPORTANT]
====
Если оставить матрицу состояний пустой, смены состояний документа на данном этапе происходить не будет.
====

.Особенности настройки матрицы состояний
****
В _Конструкторе состояний_ *обязательно* должны быть настроены переходы между используемыми в матрице состояниями карточки документа:

Для первого этапа должен быть настроен переход из стартового состояния `На согласовании` в выбранное состояние этапа.

.Стартовое состояние "На согласовании" должно:
[loweralpha]
. Быть зарегистрировано в Конструкторе состояний для вида ДокументУД.
. Иметь `BuildInState` равный `209CDCE5-83B8-4FAC-B9E5-851E6ED3A3E2` или `DefaultName` равный `Is approving` или `OnApproving`.

[loweralpha]
.Для последующих этапов:
. Должен быть настроен переход из состояния предыдущего этапа в выбранное состояние этапа.
. Должен быть настроен переход в то состояние, которое xref:route-final-state.adoc[выбрано в качестве итогового] в карточке _Маршрут согласования_.

Также в _Конструкторе ролей_ операция перехода *обязательно* должна быть разрешена для роли _Системная для WF_.
****

.Чтобы настроить матрицу состояний:
. Создайте новую или откройте существующую карточку этапа.
. Перейдите на вкладку xref:stage-additional-settings.adoc[Дополнительные настройки].
. В области _Матрица состояний документа_ нажмите на кнопку image:buttons/add_little_plus.png[Рамка с плюсом] *Добавить*, чтобы открыть окно *Состояния документа*.
+
.Добавление состояния в "Матрицу состояний"
image::state-matrix-add.png[Добавление состояния в "Матрицу состояний"]
+
. Заполните поля окна _Состояния документа_.
+
****
.В поле "Вид документа" выберите требуемый вид:
* Если выбран пользовательский вид карточки, в матрице будут доступны все состояния, существующие для этого вида.
* Если выбран вид _Документ УД_, в процессе работы будут учитываться состояния для дочерних видов, например, _Документ УД -- Исходящий_ и другие.
+
Если в матрице отсутствуют настройки для дочернего вида, будут использоваться настройки состояний для родительского вида, например, _Документ УД_.

.В поле "Состояние этапа" укажите название состояния:
* Выберите значение из _Конструктора состояний_. В _Конструкторе состояний_ должна быть обязательно настроена операция перехода в выбранное состояние из начального состояния перед стартом этапа.
* В поле _Состояние при положительном результате_ укажите название состояния при положительном решении по согласованию. Выберите значение из _Конструктора состояний_.
* В поле _Состояние при отрицательном результате_ укажите название состояния при отрицательном решении по согласованию. Выберите значение из _Конструктора состояний_.
+
Поле _Вид документа_ обязательно для заполнения. Также обязательно должно быть заполнено хотя бы одно из полей для настройки состояний.
****
+
. Нажмите на кнопку *ОК*, чтобы отобразить новую запись о состоянии карточки в таблице _Матрицы состояний_.
+
.Отображение записи о состоянии документа в "Матрице состояний"
image::state-matrix.png[Отображение записи о состоянии документа в "Матрице состояний"]
+
Чтобы настроить перенос итоговых файлов, полученных по результатам согласования, в карточку _Документ_, для выбранного состояния в _Конструкторе состояний_ должна быть разрешена операция _Редактирование основного файла_.
