= Создание шаблона согласования

Создание карточек шаблонов согласований могут производить любые пользователи модуля.

С одним шаблоном согласования могут быть связаны несколько маршрутов согласования, для которых определены различные условия запуска. При отправке карточки _Документ_ (и ее дочерних видов) на согласование, в зависимости от заданных условий, выполняется подбор подходящего маршрута. Условие запуска формируется как поисковый запрос, атрибутом которого является некоторое поле карточки _Документ_.

.Чтобы создать шаблон согласования, выполните следующие действия:
. Выполните любое из действий:
* В представлении Windows-клиента вызовите контекстное меню, затем выберите команду *Создать карточку* > *Согласование* > *Согласование КС*;
* Нажмите на кнопку *Создать карточку* на ленте Windows-клиента, затем выберите из контекстного меню кнопки вид карточки *Согласование* > *Согласование КС*.
+
В любом случае будет открыта новая карточка _Шаблон согласования_.
+
[IMPORTANT]
====
Карточка шаблона согласования должна быть карточкой вида _Согласование / Согласование КС_ или подвидов _Согласование КС_. Использование карточек других видов (включая другие подвиды _Согласование_) приведёт к ошибке согласования.
====
+
. В поле *Название* введите название шаблона.
. Чтобы при создании согласования у *Инициатора* открывалась карточка _Согласование КС_, в которой можно ознакомиться с маршрутом, снимите флаг *Запускать согласование без показа карточки*. По умолчанию параметр не установлен.
+
При отсутствии флага запуск согласования необходимо будет выполнять вручную, при помощи одноименной командой ленты. При наличии флага согласование будет запущено автоматически.
+
Данная настройка не оказывает влияния на проверку условий запуска маршрутов (если они определены).
+
. Чтобы можно было запустить процесс согласования карточки документа без вложенных основных файлов, установите флаг *Разрешить запуск согласования без файлов*.
+
В этом случае согласование будет выполняться для отправленной в задании карточки документа. _Основные_ и _дополнительные_ файлы могут быть добавлены в задание позже, в процессе активного согласования.
+
Если согласование без файлов запрещено, при запуске подготовленного согласования *инициатору* будет выдаваться предупреждение о необходимости добавления _основных_ файлов.
+
. В поле *Маршрут согласования по умолчанию* выберите карточку xref:Approval_path.adoc[Маршрут согласования], которая будет использоваться при запуске согласования по умолчанию. Поле является обязательным для заполнения.
+
Чтобы состав маршрута, используемого по умолчанию, отобразился в таблице *Состав маршрута*, установите фокус на данное поле.
+
[NOTE]
====
Один и тот же маршрут может быть использован для согласования разных видов документов.
====
+
В области *Состав маршрута* будет отображен список этапов, входящих в маршрут. Маршруты будут отображены в том же порядке, что и в xref:Path_roadmap.adoc[карте этапов].
+
Чтобы открыть этап для редактирования, дважды щелкните левой клавишей мыши по записи.
+
[#template]
.Карточка "Шаблон согласования"
image::Template.png[Карточка "Шаблон согласования"]
+
. Если шаблон предполагается использовать для запуска нескольких маршрутов, в таблице *Маршруты согласования по условию* сформируйте список маршрутов и определите для каждого из них условия старта.
+
Чтобы добавить маршрут в таблицу, нажмите кнопку image:buttons/add_green_plus.png[image] и выберите карточку нужного маршрута. Название добавленного маршрута будет отображено в поле *Маршрут*. Этапы добавленного маршрута будут отображены в таблице *Состав маршрута*. Открыть карточку добавленного маршрута можно нажатием кнопки image:buttons/view.png[image].
+
В поле *Приоритет* будет автоматически сформирован приоритет запуска маршрута, соответствующий порядковому номеру маршрута при добавлении. При необходимости приоритет может быть изменен путем перемещения строки маршрута по таблице кнопками image:buttons/arrow_up_green.png[image] и image:buttons/arrow_down_green.png[image].
+
Чтобы задать условие запуска маршрута, в поле *Условие* щелкните кнопку image:buttons/threedots.png[image] в правой части поля. В открывшемся окне *Фильтр карточек* задайте условие для поискового запроса по атрибутам документа. В данном окне можно как создать новый запрос, так и загрузить существующий. Использование поисковых запросов с параметрами запрещено. После сохранения условий поискового запроса, в поле таблицы появится значение `Задано`. Если условие не задано, поле таблицы будет пустым. При запуске согласования подбор маршрута будет выполняться по следующим правилам:
+
.. Если поле *Условие* не заполнено, маршрут будет использован в согласовании.
.. Если поле *Условие* заполнено, будет выполнен поисковый запрос. Если карточка документа удовлетворит условиям запроса, маршрут будет использован в согласовании. Условия проверяются в порядке приоритета. После нахождения первого условия, которому удовлетворит карточка документа, маршрут будет использован, а остальные условия проверяться не будут.
.. Если ни одно из условий не выполняется, в согласовании будет использован маршрут по умолчанию.
+
В поле *Описание условия* введите с клавиатуры произвольное описание созданных ранее условий запуска маршрута.
+
.Чтобы удалить маршрут из таблицы, нажмите image:buttons/delete_red_x.png[image].
. Сохраните карточку.
. Перейдите в _Справочник видов карточек_ и настройте режим создания карточки.
