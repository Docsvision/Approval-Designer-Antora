= Создать шаблон согласования

Любые пользователи модуля могут создавать карточки шаблонов согласований.

С одним шаблоном согласования могут быть связаны несколько маршрутов согласования, для которых определены различные условия запуска. При отправке карточки _Документ_ (и её дочерних видов) на согласование, в зависимости от заданных условий, выполняется подбор подходящего маршрута. Условие запуска формируется как поисковый запрос, атрибутом которого является некоторое поле карточки _Документ_.

.Чтобы создать шаблон согласования:
. Откройте карточку _Шаблон согласования_ любым из доступных способов:
* В представлении {wincl}а вызовите контекстное меню, затем выберите команду menu:Создать карточку[Согласование > Согласование КС].
* Нажмите на кнопку *Создать карточку* на ленте {wincl}а, затем выберите вид карточки menu:Согласование[Согласование КС].
+
[WARNING]
====
Карточка шаблона согласования должна быть карточкой вида _Согласование / Согласование КС_ или подвидов _Согласование КС_. Использование карточек других видов (включая другие подвиды _Согласование_) приведёт к ошибке согласования.
====
+
. В поле _Название_ введите название шаблона.
. Чтобы при создании согласования у _Инициатора_ открывалась карточка _Согласование КС_, в которой можно ознакомиться с маршрутом, снимите флаг `*Запускать согласование без показа карточки*`. По умолчанию флаг не установлен.
+
При отсутствии флага запуск согласования необходимо будет выполнять вручную, при помощи одноименной командой ленты. При наличии флага согласование будет запущено автоматически.
+
Данная настройка не влияет на проверку условий запуска маршрутов (если они определены).
+
. Чтобы можно было запустить процесс согласования карточки документа без вложенных основных файлов, установите флаг `*Разрешить запуск согласования без файлов*`.
+
В этом случае согласование будет выполняться для отправленной в задании карточки документа. _Основные_ и _дополнительные_ файлы могут быть добавлены в задание позже, в процессе активного согласования.
+
Если согласование без файлов запрещено, при запуске подготовленного согласования _инициатору_ будет выдаваться предупреждение о необходимости добавить _основные_ файлы.
+
. В поле _Маршрут согласования по умолчанию_ выберите карточку xref:approval-route.adoc["Маршрут согласования"], которая будет использоваться при запуске согласования по умолчанию. Поле обязательно для заполнения.
+
Чтобы состав маршрута, используемого по умолчанию, отобразился в таблице _Состав маршрута_, установите фокус на данное поле.
+
[TIP]
====
Один и тот же маршрут может быть использован для согласования разных видов документов.
====
+
В области _Состав маршрута_ будет отображен список этапов, входящих в маршрут. Маршруты будут отображены в том же порядке, что и в xref:route-map.adoc[карте этапов].
+
Чтобы открыть этап для редактирования, дважды щелкните левой клавишей мыши по записи.
+
[#template]
.Карточка "Шаблон согласования"
image::template.png[Карточка "Шаблон согласования"]
+
. Если шаблон предполагается использовать для запуска нескольких маршрутов, в таблице _Маршруты согласования по условию_ сформируйте список маршрутов и определите для каждого из них условия старта.
+
Чтобы добавить маршрут в таблицу, нажмите кнопку image:buttons/plus-green.png[Плюс] и выберите карточку нужного маршрута. Название добавленного маршрута будет отображено в поле _Маршрут_. Этапы добавленного маршрута будут отображены в таблице _Состав маршрута_. Открыть карточку добавленного маршрута можно нажатием кнопки image:buttons/view.png[Лупа в прямоугольнике].
+
В поле _Приоритет_ будет автоматически сформирован приоритет запуска маршрута, соответствующий порядковому номеру маршрута при добавлении. При необходимости приоритет может быть изменен путем перемещения строки маршрута по таблице кнопками image:buttons/arrow-up-green.png[Стрелка вверх] и image:buttons/arrow-down-green.png[Стрелка вниз].
+
Чтобы задать условие запуска маршрута, в поле _Условие_ щелкните кнопку image:buttons/three-dots.png[Три точки] в правой части поля. В открывшемся окне _Фильтр карточек_ задайте условие для поискового запроса по атрибутам документа. В данном окне можно как создать новый запрос, так и загрузить существующий.
+
NOTE: Использовать поисковые запросы с параметрами запрещено.
+
После сохранения условий поискового запроса, в поле таблицы появится значение `Задано`. Если условие не задано, поле таблицы будет пустым. При запуске согласования подбор маршрута будет выполняться по следующим правилам:
+
.. Если поле _Условие_ не заполнено, маршрут будет использован в согласовании.
.. Если поле _Условие_ заполнено, будет выполнен поисковый запрос. Если карточка документа удовлетворит условиям запроса, маршрут будет использован в согласовании. Условия проверяются в порядке приоритета. Когда найдено первое подходящее условие, будет выбран маршрут. Остальные условия проверяться не будут.
.. Если ни одно из условий не выполняется, в согласовании будет использован маршрут по умолчанию.
+
В поле _Описание условия_ введите произвольное описание созданных ранее условий запуска маршрута.
+
.Чтобы удалить маршрут из таблицы, нажмите image:buttons/x-red.png[Крест].
. Сохраните карточку.
. Перейдите в _Справочник видов карточек_ и настройте режим создания карточки.
