= Особенности работы с версиями и комментариями к версиям

Вкладка _Версии и комментарии_ предназначена для полнофункциональной работы с версиями в карточке заданий на согласование. Согласуемые файлы отображаются на отдельных вкладках.

[NOTE]
====
Новые файлы, xref:approval-add-files.adoc[добавленные] в согласование после его запуска, будут отображаться у согласующих после начала следующего этапа согласования.
====

.Элемент для работы с версиями файлов в режиме "Согласование"
image::version-tree.png[Элемент для работы с версиями файлов в режиме "Согласование"]

.Версии согласуемых файлов отображаются в задании следующим образом:
* _Корневая версия_ -- отображается версия, которая является текущей в карточке _Документ_.
* _Версия цикла_ -- версия документа, которая поступила на согласование при старте данного цикла. Если цикл первый, версия будет совпадать с корневой. В последующих циклах будет отображаться итоговая версия последнего из этапов цикла.
+
Данная версия формируется модулем _{dv} 5. Управление процессами_.
* _Исходная версия этапа_ -- версия, поступающая к согласующему при старте очередного этапа. Данная версия формируется модулем _{dv} 5. Управление процессами_.
* _Версия согласующего_ -- версия отдельного участника согласования, созданная им вручную. Может быть создана как на основе версии другого согласующего, так и на основе _Исходной версии этапа_.
+
[NOTE]
====
Версия не создается на этапе подписания.
====
+
****
Если для этапа настроен тип маршрутизации _параллельный_, все согласующие получат для согласования _исходную версию этапа_ -- для первого этапа в цикле совпадает с версией цикла.

Если в процессе согласования будут добавлены _версии согласующих_, они будут независимо сохранены.

Объединение версий согласующих в рамках этапа возможно только на этапе консолидации.

.На следующий этап будет передана:
* Версия консолидатора -- если консолидация выполнялась.
* Версия согласующего -- если в этапе была создана только одна версия.
* Или исходная версия этапа -- если в этапе было создано несколько версий.

Каждый следующий согласующий будет получать для согласования не _исходную версию этапа_, а версию предыдущего согласующего, если для этапа настроен тип маршрутизации _последовательный_ или _альтернативный_, и в процессе согласования будут добавлены _версии согласующих_.

Таким образом, в версии последнего согласующего этапа будут накоплены все изменения, которые будут выполнены на этапе, и эта версия поступит в качестве _Исходной версии_ на следующий этап.

.Такой способ формирования версий этапов имеет ряд особенностей:
* Предыдущий этап должен был быть выполнен отдельно, а не одновременно с другим этапом.
* Если ни одной версии на этапе создано не было, на следующий этап будет передана та же версия, что и на предыдущий этап.
* Если предшествующий текущему этап был с типом маршрутизации _параллельный_ или же стартовал одновременно с другим этапом, на вход текущему этапу будет передана та же версия, что и на предыдущие этапы.
* Если предшествующий текущему этап был запущен в режиме _консолидация_, на вход текущему этапу будет передана _Итоговая версия этапа_, сформированная на этапе консолидации.
****

[#view-version]
== Просмотр версии файла

Выбранная версия файла может быть открыта во встроенном средстве просмотра {dv} (при условии, если средство допускает просмотр файлов данного типа).

.Чтобы просмотреть текст документа:
. Откройте карточку задания на согласование документа.
. Выберите версию файла, которую требуется просмотреть.
. Правой кнопкой мыши вызовите контекстное меню, затем выберите команду _Просмотреть_.
+
Будет открыто окно для просмотра версии файла документа.
+
.Просмотр версии файла в карточке _Согласование_
image::files_version_view.png[Просмотр версии файла в карточке _Согласование_]
+
. Чтобы закрыть окно, нажмите на кнопку в правом верхнем углу окна.

[#open-version]
== Открытие версии файла на чтение или редактирование

Версию согласуемого файла можно открыть во внешнем редакторе, соответствующем типу файла. Для всех версий файла предусмотрен режим открытия "на чтение", для собственных версий согласующего предусмотрен режим открытия файла на редактирование -- только для файлов: `.doc`, `.docm`, `.docx`, `.txt`, `.rtf`, `.xls`, `.xlsm`, `.xlsx`, `.ppt`, `.pptx`, `.vsd`, `.vsdx`. Количество версий, открываемых в режиме редактирования, не ограничено.

[IMPORTANT]
====
При редактировании файла Microsoft Office, открытого из карточки, следует избегать параллельного открытия файлов с аналогичным именем (из других источников), т.к. это может привести к невозможности сохранения изменений файла в карточку.
====

.Чтобы открыть версию файла:
. Откройте карточку задания на согласование документа.
. Выберите версию файла, которую необходимо открыть.
. Чтобы открыть версию файла в редакторе в режиме чтения выполните любое из действий:
* Правой кнопкой мыши вызовите контекстное меню, затем выберите команду _Открытьfootnote:[Команда доступна, если на компьютере пользователя установлен редактор, соответствующий типу файла.]_.
* Дважды щелкните левой клавишей мыши по названию файла.
+
.Открытие файла в режиме чтения
image::open-version.png[Открытие файла в режиме чтения]
+
. Просмотрите и закройте файл.
+
Если в файл были внесены изменения, при закрытии файла выберите, хотите ли вы сохранить изменения. Если вы выбрали сохранить изменения, будет открыто окно для выбора места сохранения файла в файловой системе.

[#load-version]
== Загрузка версии из файла

Загрузка версии предназначена для внесения изменений в файлы различных форматов или для загрузки файла из системы, внешней по отношению к {dv}. Загрузить можно как ранее выгруженный файл, так и новый файл. Операция доступна также для исходных версий этапа.

.Чтобы создать новую версию документа или загрузить свою версию из файла:
. Откройте карточку задания на согласование документа.
. На вкладке файла документа правой кнопкой мыши вызовите контекстное меню, затем выберите команду _Загрузить из файла_, чтобы открыть окно для выбора файла из файловой системы.
+
. Выберите для загрузки файл с тем же именем и расширением, что и выгруженный файл.
+
[NOTE]
====
При работе с файлами MS Office следует учитывать, что если файл выгружен в новый формат, например, `.docx` вместо выгруженного `.doc`, версия файла загружена не будет.
====
+
На вкладке в дерево версий файла будет добавлена новая версия файла, название которой содержит фамилию сотрудника, внесшего изменения.

[#create-version]
== Создание версии файла на основе выбранной

Создание версии на основе выбранной используется, если требуется внести изменения в файл документа, и сохранить внесенные изменения в новой версии файла. Версия может создаваться как на основе xref:approval-versions-comments.adoc[Исходной версии этапа], так и на основе версии другого участника согласования. Созданная версия файла доступна в режиме редактирования.

.Чтобы добавить новую версию документа:
. Откройте карточку задания на согласование документа.
. Выберите версию файла, на основе которой необходимо создать новую версию.
. Правой кнопкой мыши вызовите контекстное меню, затем выберите команду _Создать версию на основе выбраннойfootnote:[Команда доступна только для файлов в формате `.txt`, `.docx` и `.xlsx`]_, чтобы открыть редактор файла.
+
. Внесите необходимые исправления в файл.
. Сохраните и закройте файл.
+
Если версия, выбранная в качестве основной, была подписана ЭЦП другим участников, то при сохранении будет выдано предупреждение.
+
.Предупреждение при сохранении файла с ЭЦП
image::file-signed-alert.png[Предупреждение при сохранении файла с ЭЦП]
+
Чтобы сохранить свою версию, ответьте утвердительно, иначе версия сохранена не будет.
+
После сохранения, на вкладке добавится новая версия файла, название которой содержит фамилию сотрудника, внесшего изменения.
+
.Отображение новой версии файла
image::files_new_version.png[Отображение новой версии файла]

[#comment-version]
== Добавление комментария к версии

К любой из версий файла, добавленных согласующими, может быть добавлен текстовый комментарий.

.Чтобы добавить комментарий к версии документа:
. Откройте карточку задания на согласование документа.
. На вкладке файла в дереве версий выберите ту версию, к которой необходимо добавить комментарий, правой кнопкой мыши вызовите контекстное меню, затем выберите команду _Комментировать_, чтобы открыть окно для добавления комментария.
+
.Добавление текстового комментария к версии
image::add-comment.png[Добавление текстового комментария к версии]
+
. Добавьте свой комментарий и нажмите кнопку *Сохранить*.
+
Добавленный комментарий будет отображаться у _Инициатора_ согласования в поле _Комментарий_.
+
.Отображение добавленного к версии комментария
image::comment-added.png[Отображение добавленного к версии комментария]

[#delete-version]
== Удаление версии файла

Пользователь может удалить только собственную версию файла. Все комментарии, относящиеся к данной версии, будут удалены.

.Чтобы удалить версию файла:
. Откройте карточку задания на согласование документа.
. Выберите версию файла, которую необходимо удалить.
. Правой кнопкой мыши вызовите контекстное меню, затем выберите команду _Удалить версию_.
+
[NOTE]
====
Если на основе выбранной версии файла была создана ещё одна версия, выбранная версия файла не может быть удалена.
====
+
Версия перестанет отображаться на вкладке файла.

[#ops-availability]
== Доступность операций с файлами в различных режимах согласования

=== Режим "Согласование"

[cols="32%,15%,15%,19%,19%",options="header"]
|===
|Операция/тип версии |Корневая версия |Версия цикла |Исходная версия этапа |Версия согласующего

|Просмотреть |Да |Да |Да |Да

|Открыть на чтение |Да |Да |Да |Да

|Открыть на редактирование | | | |Да, если текущий сотрудник -- автор

|Создать версию на основе выбранной | | |Да |Да

|Удалить | | | |Да, если текущий сотрудник -- автор

|Комментировать | | | |Да

|Загрузить из файлаfootnote:[Команда всегда создает новую версию, не зависит от состояния других файлов] | | |Да |Да
|===

[cols="37%,17%,23%,23%",options="header"]
|===
|Операция/тип версии |Объединенная версия этапа |Консолидируемая версия |Консолидированная версия

|Просмотреть |Да |Да |Да

|Открыть на чтение |Да |Да |Да

|Открыть на редактирование | | |

|Создать версию на основе выбранной | | |

|Удалить | | |

|Комментировать | | |

|Загрузить из файла | | |
|===

=== Режим "Консолидация"

[cols="32%,15%,15%,19%,19%",options="header"]
|===
|Операция/тип версии |Корневая версия |Версия цикла |Исходная версия этапа |Версия согласующего

|Просмотреть |Да |Да |Да |Да

|Открыть на чтение |Да |Да |Да |Да

|Открыть на редактирование | | | |

|Удалить | | | |

|Комментировать | | | |Да

|Взять в качестве консолидируемой | |Да |Да |Да

|Сделать версию текущей | |Да |Да |Да

|Загрузить из файла | | |Да |

|Объединить версии | | |Да |
|===

[cols="37%,17%,23%,23%",options="header"]
|===
|Операция/тип версии |Объединенная версия этапа |Консолидируемая версия |Консолидированная версия

|Просмотреть |Да |Да |Да

|Открыть на чтение |Да |Да |Да

|Открыть на редактирование | |Да, если текущий сотрудник -- автор |

|Удалить | |Да, если текущий сотрудник -- автор |

|Комментировать | |Да |

|Взять в качестве консолидируемой |Да | |

|Сделать версию текущей |Да |Да |

|Загрузить из файла | |Да |

|Объединить версии | | |
|===

=== Режим "Подписание"

[cols=",",options="header"]
|===
|Операция/тип версии |Исходная версия этапа

|Просмотреть |Да
|===
